<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management</title>
</head>
<body>
    <h1>Inventory Management</h1>

    <h2>Consume Item</h2>
    <label for="itemName">Item Name:</label>
    <input type="text" id="itemName" onkeyup="showSuggestions()">
    <div id="suggestions"></div>

    <label for="itemCode">Item Code:</label>
    <input type="text" id="itemCode" readonly>
    
    <label for="consumedArea">Consumed Area:</label>
    <select id="consumedArea">
        <option>Pump House</option>
        <option>R.O Plant</option>
        <option>Furnace</option>
        <option>Gas Zone</option>
        <option>Material Handling</option>
        <option>Operations</option>
        <option>Electrical</option>
    </select>
    
    <label for="date">Date:</label>
    <input type="date" id="date">
    
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity">
    
    <label for="shift">Shift:</label>
    <select id="shift">
        <option>General</option>
        <option>A-Shift</option>
        <option>B-Shift</option>
        <option>C-Shift</option>
    </select>

    <button onclick="consumeItem()">Consume</button>
    
    <h2>Consumption History</h2>
    <div id="history"></div>

    <script>
    // ✅ Fetch Items for Search (Auto-suggestion)
    document.getElementById("searchBox").addEventListener("input", function() {
        let query = this.value;
        if (query.length < 1) {
            document.getElementById("suggestions").innerHTML = "";
            return;
        }

        fetch("/get-items")
            .then(response => response.json())
            .then(items => {
                let matches = items.filter(item => 
                    item["Item Name"].toLowerCase().includes(query.toLowerCase())
                );

                document.getElementById("suggestions").innerHTML = matches
                    .map(item => `<p onclick="selectItem('${item["Item Name"]}', '${item["Item Code"]}')">${item["Item Name"]} (${item["Item Code"]})</p>`)
                    .join("");
            })
            .catch(error => console.error("Error fetching items:", error));
    });

    function selectItem(itemName, itemCode) {
        document.getElementById("searchBox").value = itemName;
        document.getElementById("itemCode").value = itemCode;  // Fill item code automatically
        document.getElementById("suggestions").innerHTML = "";
    }

    // ✅ Fetch and Display Consumption History
    function loadConsumptionHistory() {
        fetch("/consumption-history")
            .then(response => response.json())
            .then(data => {
                let historyTable = "<table border='1'><tr><th>Item Name</th><th>Item Code</th><th>QTY</th><th>Consumed Area</th><th>Date</th><th>Shift</th></tr>";
                data.forEach(entry => {
                    historyTable += `<tr>
                        <td>${entry["Item name"]}</td>
                        <td>${entry["Item code"]}</td>
                        <td>${entry["QTY"]}</td>
                        <td>${entry["Consumed Area"]}</td>
                        <td>${entry["Date"]}</td>
                        <td>${entry["Shift"]}</td>
                    </tr>`;
                });
                historyTable += "</table>";
                document.getElementById("consumptionHistory").innerHTML = historyTable;
            })
            .catch(error => console.error("Error fetching consumption history:", error));
    }

    // ✅ Load history on page load
    window.onload = loadConsumptionHistory;
</script>


</body>
</html>
