<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRS Entry</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#addItem").click(function () {
                let newRow = `<tr class="item-row">
                    <td><input type="text" name="item_name[]" class="item-name" required></td>
                    <td><input type="text" name="item_code[]" class="item-code" readonly></td>
                    <td><input type="number" name="quantity[]" class="quantity" required></td>
                    <td><button type="button" class="removeItem">Remove</button></td>
                </tr>`;
                $("#itemsTable tbody").append(newRow);
            });

            $(document).on("click", ".removeItem", function () {
                $(this).closest("tr").remove();
            });

            $(document).on("input", ".item-name", function () {
                let itemName = $(this).val();
                let itemCodeField = $(this).closest("tr").find(".item-code");
                $.ajax({
                    url: '/get-item-code',
                    method: 'POST',
                    data: { item_name: itemName },
                    success: function (response) {
                        itemCodeField.val(response.item_code);
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h2>MRS Entry</h2>
    <form id="mrsForm" action="/submit-mrs" method="post">
        <label>Area: <input type="text" name="area" required></label>
        <label>Receiver: <input type="text" name="receiver" required></label>
        <label>In-charge: <input type="text" name="incharge" required></label>
        <label>Contractor: <input type="text" name="contractor" required></label>
        <label>Date: <input type="date" name="date" required></label>
        <table id="itemsTable">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Item Code</th>
                    <th>Quantity</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr class="item-row">
                    <td><input type="text" name="item_name[]" class="item-name" required></td>
                    <td><input type="text" name="item_code[]" class="item-code" readonly></td>
                    <td><input type="number" name="quantity[]" class="quantity" required></td>
                    <td><button type="button" class="removeItem">Remove</button></td>
                </tr>
            </tbody>
        </table>
        <button type="button" id="addItem">Add More Items</button>
        <button type="submit">Submit</button>
    </form>

    <h2>Consumption History</h2>
    <table>
        <thead>
            <tr>
                <th>Area</th>
                <th>Receiver</th>
                <th>Item Name</th>
                <th>Item Code</th>
                <th>Quantity</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="historyTable">
            <!-- Existing consumption history rows will be loaded dynamically -->
        </tbody>
    </table>
</body>
</html>
